{% extends 'default.html.twig' %}

{% block title %}Cart{% endblock %}
{% block content %}
    <div class="container mt-4">
    <h1>Your Cart</h1>
    {% include '/parts/flash.html.twig' %}
    {% if items | length > 0 %}
        <div class="row mt-4">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header bg-dark text-white d-flex">
                        <h5>Items</h5>
                        <div class="ml-auto">
                        </div>
                    </div>
                    <ul class="list-group list-group-flush">
                        {% for item in items %}
                            <li class="list-group-item d-flex">
                                <div class="flex-fill mr-2">
                                    <img src="https://via.placeholder.com/200x150" width="100" alt="Product image">
                                    <h5 class="mt-0 mb-0">{{ item.product.code }}</h5>
                                </div>
                                <div class="flex-fill mr-2">
                                    <ul class="list-group list-group-flush">
                                        <li class="list-group-item d-flex justify-content-between">
                                            <h5 class="mt-0 mb-0">{{ item.product.name }}</h5>

                                            <a href="{{ path('cart_remove', {'productCode': item.product.code}) }}"
                                               class="btn btn-sm btn-danger" id="delete_cart" data-prod-code="{{ item.product.code }}"
                                            data-product-amount="{{ item.amount }}" data-product-price="{{ item.product.price }}">
                                                <i class="bi bi-trash"></i>
                                                Delete
                                            </a>


                                        </li>
                                    </ul>
                                    <div class="form-inline mt-2">
                                        <div class="form-group mb-0 mr-2">
                                            <div style="display: inline-flex; gap:10px;">
                                                <label>Amount</label>
                                                {{ item.amount }}
                                            </div>
                                        </div>
                                    </div>
                                    <div class="flex-fill mr-2 text-right">
                                        <b>Price:</b><small> per unit</small>
                                        <br><b>{{ item.product.price }}$</b>
                                    </div>
                                </div>
                            </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card mt-4 mt-md-0">
                    <div class="card-header bg-dark text-white">
                        <h5>Summary</h5></div>
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item d-flex justify-content-between">
                            <div><b>Total</b></div>
                            <span><b id="total">{{ total }} $</b></span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        </div>
    {% else %}
        <div class="alert alert-info">
            Your cart is empty. But it's easy to fix! Go shopping for <a href="{{ path('product_index') }}">Product</a>.
        </div>
    {% endif %}

    <section class="section-name bg-white padding-y">
        <div class="container">
            <header class="section-heading">
                <h2 class="title-section">Delivery condition</h2>
            </header>
            <p>We collect some of your personal information (name, age, interests, e-mail, etc.) from you in
                order to provide better service to customers.This information collected in the servers, periodical
                campaign studies, special profiles for customer profiles and the organization of the promotion of
                unsolicited e-mail "customer" in the work of "classification" studies only Shopping Shop. is used
                within.
                <br>Shopping Shop Does not share the information collected from the membership forms with third parties
                without the information of the member in question or otherwise, does not use it for commercial purposes
                and does not sell it for any other reason.
                <br>E-mail addresses and membership forms, as well as the personal information requested during the use
                of the site, the visitor movements and preferences by analyzing and interpreting.
                This statistical data does not contain personal information, Shopping Shop can be shared with business
                partners.
            </p>
        </div>
    </section>

    <section class="section-name bg padding-y">
        <div class="container">
            <h4>How do you contact us if your order does not arrive?</h4>
            <p>We recommend contacting the supplier first. There could be a reasonable explanation for a
                late delivery. It happens. For example, I recently bought a bathing suit online and it was
                a couple of weeks late because of a typhoon â€“ in my opinion, this is completely understandable.</p>
        </div>
    </section>
    <script>
        async function deleteItem(productCode) {
            let url = "{{ path("cart_remove", {'productCode': 'PRODUCT_CODE'}) }}".replace('PRODUCT_CODE', productCode);
            return await fetch(url, {method: 'DELETE'});
        }
        $(document).on('click', '#delete_cart', function (e) {
            e.preventDefault();
            deleteItem(e.target.getAttribute('data-prod-code')).then(function (res) {
                console.log(res.status);
                location.reload();
            })
                .catch(function () {
                    console.log("You died.");
                });
        })
    </script>
{% endblock %}